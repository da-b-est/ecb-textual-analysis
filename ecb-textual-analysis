{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "8bb9d7ea-0d09-4232-ba5b-965c99983338",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[nltk_data] Downloading package punkt to\n",
      "[nltk_data]     /Users/biancafernandes/nltk_data...\n",
      "[nltk_data]   Package punkt is already up-to-date!\n",
      "[nltk_data] Downloading package stopwords to\n",
      "[nltk_data]     /Users/biancafernandes/nltk_data...\n",
      "[nltk_data]   Package stopwords is already up-to-date!\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import re\n",
    "import nltk\n",
    "from nltk.tokenize import word_tokenize\n",
    "from nltk.corpus import stopwords\n",
    "from nltk.stem import PorterStemmer\n",
    "from nltk.util import bigrams\n",
    "from sklearn.metrics import jaccard_score\n",
    "import numpy as np\n",
    "import os\n",
    "from pandas_datareader.fred import FredReader\n",
    "from statsmodels.tsa.filters.hp_filter import hpfilter\n",
    "import matplotlib.pyplot as plt\n",
    "import requests\n",
    "from bs4 import BeautifulSoup"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1cfa10ce-48c0-4942-a82f-4b9bd2284347",
   "metadata": {},
   "source": [
    "# Load the data"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "02f5d057-33f6-46ae-9b58-8d51dec198f4",
   "metadata": {},
   "source": [
    "## Get all the links"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "55658520-aa34-41ad-8e6f-f1372e2ebeed",
   "metadata": {},
   "outputs": [],
   "source": [
    "from selenium import webdriver\n",
    "from selenium.webdriver.chrome.service import Service\n",
    "from selenium.webdriver.common.by import By\n",
    "from selenium.webdriver.support.ui import WebDriverWait\n",
    "from selenium.webdriver.support import expected_conditions as EC\n",
    "import time\n",
    "\n",
    "# Path to your ChromeDriver file\n",
    "chrome_driver_path = \"/Users/biancafernandes/Downloads/chromedriver\"\n",
    "\n",
    "# Set up ChromeDriver\n",
    "service = Service(chrome_driver_path)\n",
    "driver = webdriver.Chrome(service=service)\n",
    "\n",
    "# Open the webpage\n",
    "url = \"https://www.ecb.europa.eu/press/press_conference/monetary-policy-statement/html/index.en.html\"\n",
    "driver.get(url)\n",
    "\n",
    "try:\n",
    "    # Wait for the page to load\n",
    "    WebDriverWait(driver, 10).until(EC.presence_of_all_elements_located((By.CLASS_NAME, \"lazy-load\")))\n",
    "\n",
    "    # Scroll to each lazy-load container\n",
    "    lazy_load_elements = driver.find_elements(By.CLASS_NAME, \"lazy-load\")\n",
    "    for lazy_element in lazy_load_elements:\n",
    "        # Scroll to the lazy-load element\n",
    "        driver.execute_script(\"arguments[0].scrollIntoView(true);\", lazy_element)\n",
    "        time.sleep(2)  # Wait briefly for content to load\n",
    "\n",
    "    # Extract all links under 'div.title'\n",
    "    my_list = []\n",
    "    elements = driver.find_elements(By.CLASS_NAME, \"title\")\n",
    "    for element in elements:\n",
    "        links = element.find_elements(By.TAG_NAME, \"a\")\n",
    "        for link in links:\n",
    "            my_list.append(link.get_attribute(\"href\"))\n",
    "\n",
    "    # Print the list of links\n",
    "    print(my_list)\n",
    "\n",
    "except Exception as e:\n",
    "    print(f\"Error: {e}\")\n",
    "\n",
    "finally:\n",
    "    # Close the browser\n",
    "    driver.quit()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6f51219c-8ce4-4941-a704-03d0c70e8add",
   "metadata": {},
   "source": [
    "## Get the content of each links"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "38b0ba96-d223-453b-876b-c056ad3caf89",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Step 1: Load the Excel file\n",
    "file_path = \"/Users/wujiayi/desktop/FTD/Applied Data Science/project/ECB_Links.xlsx\"  # Replace with your Excel file path\n",
    "links_df = pd.read_excel(file_path)\n",
    "links = links_df[\"URL\"]\n",
    "\n",
    "# Define the patterns to exclude\n",
    "exclude_patterns = [\n",
    "    \"/tvservices/\",\n",
    "    \"https://www.ecb.europa.eu/press/press_conference/monetary-policy-statement/2002/html/is020103_2.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/press_conference/monetary-policy-statement/2003/html/is030508_1.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/press_conference/monetary-policy-statement/2005/html/is050120.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/press_conference/monetary-policy-statement/2005/html/is050120_1.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2023/html/ecb.mp230914~aab39f8c21.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2023/html/ecb.mp231026~6028cea576.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2023/html/ecb.mp231214~9846e62f62.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2024/html/ecb.mp240125~f738889bde.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2024/html/ecb.mp240411~1345644915.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2024/html/ecb.mp240606~2148ecdb3c.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2024/html/ecb.mp240718~b9e0ddd9d5.en.html\",\n",
    "    \"https://www.ecb.europa.eu/press/pr/date/2024/html/ecb.mp240912~67cb23badb.en.html\",\n",
    "]\n",
    "\n",
    "# Drop rows where the URL contains any of the exclude patterns\n",
    "links = links_df[\"URL\"][~links_df[\"URL\"].str.contains('|'.join(map(re.escape, exclude_patterns)))]\n",
    "\n",
    "# Reset index if necessary\n",
    "links = links.reset_index(drop=True)\n",
    "\n",
    "# Initialize a DataFrame to store results\n",
    "data = []\n",
    "\n",
    "# Loop through each link and extract the required information\n",
    "for link in links:\n",
    "    try:\n",
    "        # Request the content of the page\n",
    "        req = requests.get(link)\n",
    "        req.raise_for_status()  # Ensure the request was successful\n",
    "        r = BeautifulSoup(req.content, \"html.parser\")\n",
    "\n",
    "        # Extract publication date\n",
    "        publication_date = None\n",
    "        for date in r.find_all('meta'):\n",
    "            if date.get('property') == 'article:published_time':\n",
    "                publication_date = date.get('content')\n",
    "                break\n",
    "\n",
    "        # Extract the main text\n",
    "        full_text = []\n",
    "        for element in r.find_all('div', {'class': 'section'}):\n",
    "            for text in element.find_all(\"p\"):\n",
    "                if text.find('a', {'id': 'qa'}):  # Stop when the Q&A section is found\n",
    "                    break\n",
    "                full_text.append(text.text.strip())\n",
    "\n",
    "        # Append the extracted data to the list\n",
    "        data.append({\n",
    "            \"Link\": link,\n",
    "            \"Publication Date\": publication_date,\n",
    "            \"Content\": \" \".join(full_text)\n",
    "        })\n",
    "    except Exception as e:\n",
    "        print(f\"Failed to process link {link}: {e}\")\n",
    "\n",
    "# Convert the data to a DataFrame\n",
    "df_all= pd.DataFrame(data)\n",
    "df_all=df_all.dropna()\n",
    "\n",
    "# Save the DataFrame to a CSV file\n",
    "df_all.to_csv(\"ecb_press_conference_data1.csv\", index=False)\n",
    "\n",
    "print(\"Scraping complete. Data saved to ecb_press_conference_data1.csv.\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "51b5f12f-65e4-413c-a0f8-301247632fe8",
   "metadata": {},
   "source": [
    "## Output"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "41c3a52e-be8d-43ae-8e91-58c9763e9b92",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Step 1: Fetch GDP data\n",
    "fred_indicators = ['CLVMNACSCAB1GQEA19']  # GDP, Europe\n",
    "df = FredReader(symbols=fred_indicators, start='1999', end=None).read()\n",
    "\n",
    "# Step 2: Rename the column\n",
    "rename_dict = {'CLVMNACSCAB1GQEA19': 'Y'}\n",
    "df = df.rename(columns=rename_dict)\n",
    "\n",
    "# Step 3: Apply HP filter with lambda = 1600 (for quarterly data)\n",
    "gdp_cycle, gdp_trend = hpfilter(df['Y'], lamb=1600)\n",
    "\n",
    "# Step 4: Add trend and output gap to the DataFrame\n",
    "df['Potential_GDP'] = gdp_trend\n",
    "df['Output_Gap'] = gdp_cycle\n",
    "\n",
    "# Ensure index is in datetime format\n",
    "df.index = pd.to_datetime(df.index)\n",
    "\n",
    "# Step 5: Calculate Output Gap as a percentage of Potential GDP\n",
    "df['Output_Gap_Percent'] = (df['Output_Gap'] / df['Potential_GDP']) * 100\n",
    "\n",
    "# Inspect the DataFrame\n",
    "print(\"Quarterly Data with Output Gap:\")\n",
    "print(df.head())\n",
    "\n",
    "# Save to Excel\n",
    "df.to_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Y_gap_quarterly.xlsx\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "acca8fe5-75ad-409b-a24d-c09ad303fa1f",
   "metadata": {},
   "source": [
    "## Stock Market"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "28365776-77a6-483a-baa4-10cc7b701a41",
   "metadata": {},
   "outputs": [],
   "source": [
    "df= pd.read_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/STOXXEurope50Index(EUR).csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d4287166-4150-4c0a-ab0e-e91d4a12677d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Step 1: Strip spaces from column names\n",
    "df.columns = df.columns.str.strip()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7592c33c-7463-49b6-93b8-5ad90745760a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Step 1: Correct the Date column and set it as index\n",
    "df['Date'] = pd.to_datetime(df['Date'], format='%m/%d/%y')\n",
    "df.set_index('Date', inplace=True)\n",
    "\n",
    "# Step 2: Correct the Close column\n",
    "df['Close'] = df['Close'].str.replace(',', '').astype(float)\n",
    "\n",
    "# Step 3: Calculate the daily return\n",
    "df['Return'] = np.log(df['Close'] / df['Close'].shift(1))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "63217ffc-c0ec-4ee1-bda6-b547c556cfe1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Save to Excel\n",
    "df.to_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/StockMarket.xlsx\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1c2e6a4a-3589-4b7c-9c18-d8b6a0da8716",
   "metadata": {},
   "source": [
    "## HICP"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "29938f38-9cb7-46b7-9627-1c988f729797",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Load the file directly\n",
    "file_path = '/content/Inflation_EU.xlsx'\n",
    "\n",
    "# Reading the Excel file\n",
    "df = pd.read_excel(file_path)\n",
    "\n",
    "# Display the first records of the dataframe\n",
    "print(\"Data loaded:\")\n",
    "print(df.head())\n",
    "\n",
    "# Ensure the date column is in datetime format\n",
    "df['TIME_PERIOD'] = pd.to_datetime(df['TIME_PERIOD'])\n",
    "\n",
    "# Sort the data by date\n",
    "df = df.sort_values(by='TIME_PERIOD')\n",
    "\n",
    "# Calculate the monthly inflation percentage (based on the HICP index)\n",
    "df['monthly_inflation'] = df['HICP'].pct_change() * 100\n",
    "\n",
    "# Calculate annualized inflation\n",
    "# Formula: (1 + monthly_inflation/100)^12 - 1\n",
    "df['annualized_inflation'] = (1 + df['monthly_inflation'] / 100)**12 - 1\n",
    "\n",
    "# Convert to percentage\n",
    "df['annualized_inflation_percent'] = df['annualized_inflation'] * 100\n",
    "\n",
    "# Display the updated data\n",
    "print(\"\\nData with annualized inflation:\")\n",
    "print(df.head())\n",
    "\n",
    "# Save the updated dataframe to an Excel file\n",
    "output_file = '/content/annualized_inflation.xlsx'\n",
    "df.to_excel(output_file, index=False)\n",
    "\n",
    "# Provide the updated file for download\n",
    "from google.colab import files\n",
    "files.download(output_file)\n",
    "\n",
    "# Filter data for a specific date range\n",
    "start_date = '1999-01-01'\n",
    "end_date = '2013-12-31'\n",
    "filtered_df = df[(df['TIME_PERIOD'] >= start_date) & (df['TIME_PERIOD'] <= end_date)]\n",
    "\n",
    "# Calculate the average annualized inflation for the filtered period\n",
    "average_annualized_inflation = filtered_df['annualized_inflation_percent'].mean()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2412a72e-6366-4c38-ac4c-28cbc973e52f",
   "metadata": {},
   "source": [
    "## Similarity-Regression 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8156d712-9c6a-429a-8a57-56d10e58b753",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Download necessary NLTK resources\n",
    "nltk.download('punkt')\n",
    "nltk.download('stopwords')\n",
    "\n",
    "df_all= pd.read_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/ecb_press_conference_data1.csv\")\n",
    "\n",
    "df_all= df_all.dropna()\n",
    "\n",
    "df_all['Publication Date'] = pd.to_datetime(df_all['Publication Date'], format='%Y-%m-%d')\n",
    "\n",
    "reference_date = pd.to_datetime(\"1999-01-01\")\n",
    "df_all['Days passed'] = (df_all['Publication Date'] - reference_date).dt.days\n",
    "\n",
    "def clean_text(text):\n",
    "    # Convert to lowercase\n",
    "    text = text.lower()\n",
    "    # Remove extra whitespaces\n",
    "    text = text.strip()\n",
    "    # Remove special characters\n",
    "    text = re.sub(r'[^\\w\\s]', '', text)\n",
    "    return text\n",
    "\n",
    "# Apply cleaning function\n",
    "df_all['Content'] = df_all['Content'].apply(clean_text)\n",
    "\n",
    "stop_words = set(stopwords.words('english'))\n",
    "stemmer = PorterStemmer()\n",
    "\n",
    "\n",
    "def preprocess_content(content):\n",
    "    # Tokenize the content into words\n",
    "    words = word_tokenize(content)\n",
    "    \n",
    "    # Remove stopwords and stem the words\n",
    "    processed_words = [stemmer.stem(word) for word in words if word.lower() not in stop_words and word.isalpha()]\n",
    "    \n",
    "    # Join the processed words back into a string\n",
    "    return ' '.join(processed_words)\n",
    "\n",
    "# Apply the function to the 'Content' column\n",
    "df_all['Processed Content'] = df_all['Content'].apply(preprocess_content)\n",
    "\n",
    "def get_bigrams(content):\n",
    "    # Generate bigrams from the processed content\n",
    "    return set(bigrams(content.split()))  # Using split() because 'Processed Content' is a string\n",
    "\n",
    "# Function to calculate Jaccard Similarity\n",
    "def jaccard_similarity(bigrams_1, bigrams_2):\n",
    "    # Find the intersection and union of bigrams\n",
    "    intersection = len(bigrams_1.intersection(bigrams_2))\n",
    "    union = len(bigrams_1.union(bigrams_2))\n",
    "    # Calculate Jaccard similarity\n",
    "    if union == 0:\n",
    "        return 0  # Avoid division by zero\n",
    "    return intersection / union\n",
    "\n",
    "# Apply the get_bigrams function to create a new column with bigrams\n",
    "df_all['Bigrams'] = df_all['Processed Content'].apply(get_bigrams)\n",
    "\n",
    "def calculate_successive_similarity(df):\n",
    "    similarities = []\n",
    "    for i in range(1, len(df)):\n",
    "        # Get bigrams of successive rows\n",
    "        bigrams_1 = df.iloc[i-1]['Bigrams']\n",
    "        bigrams_2 = df.iloc[i]['Bigrams']\n",
    "        \n",
    "        # Calculate the similarity between successive rows\n",
    "        similarity = jaccard_similarity(bigrams_1, bigrams_2)\n",
    "        similarities.append(similarity)\n",
    "    \n",
    "    # Add the similarity results to the DataFrame, aligned with the rows (skip the first row)\n",
    "    df['Similarity with Previous'] = [None] + similarities\n",
    "    return df\n",
    "\n",
    "# Calculate the similarity and add the column to the dataframe\n",
    "df_all = calculate_successive_similarity(df_all)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "518356ae-59d5-450b-9889-c5ced5d6131b",
   "metadata": {
    "collapsed": true,
    "jupyter": {
     "outputs_hidden": true
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.350419</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.304114</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.386910</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.305423</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  Similarity with Previous  \n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...                       NaN  \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...                  0.350419  \n",
       "2  {(decis, taken), (measur, either), (growth, re...                  0.304114  \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...                  0.386910  \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...                  0.305423  "
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_all.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2e974570-5e6a-4bbd-b8a3-43746d087c65",
   "metadata": {},
   "source": [
    "## Pessimism"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d6cfbcc5-60c6-4433-98d4-a57d6c1d0cd3",
   "metadata": {},
   "outputs": [],
   "source": [
    "from Regression_1 import * \n",
    "\n",
    "# Step 1: Load Loughran and McDonald word list\n",
    "word_list_path = \"/Users/wujiayi/desktop/FTD/Applied Data Science/project/Loughran-McDonald_MasterDictionary_1993-2023.csv\"  # Replace with your CSV file path\n",
    "word_list_df = pd.read_csv(word_list_path)\n",
    "\n",
    "# Extract positive and negative word lists\n",
    "positive_words = set(word_list_df[word_list_df['Positive'] != 0]['Word'].str.lower())\n",
    "negative_words = set(word_list_df[word_list_df['Negative'] != 0]['Word'].str.lower())\n",
    "\n",
    "# Step 2: Define a function to calculate the pessimism metric\n",
    "def calculate_pessimism(content):\n",
    "    # Tokenize the processed content\n",
    "    words = word_tokenize(content)\n",
    "    \n",
    "    # Convert words to lowercase for matching\n",
    "    words_lower = [word.lower() for word in words]\n",
    "    \n",
    "    # Count positive, negative, and total words\n",
    "    positive_count = sum(1 for word in words_lower if word in positive_words)\n",
    "    negative_count = sum(1 for word in words_lower if word in negative_words)\n",
    "    total_word_count = len(words_lower)\n",
    "    \n",
    "    # Calculate pessimism metric\n",
    "    if total_word_count == 0:\n",
    "        return None  # Avoid division by zero\n",
    "    return (negative_count - positive_count) / total_word_count\n",
    "\n",
    "# Step 3: Apply the function to your DataFrame\n",
    "df_all['Pessimism'] = df_all['Content'].apply(calculate_pessimism)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2961e64d-6b23-4d84-a1ca-dab32705b8e2",
   "metadata": {},
   "source": [
    "# Merge with HICP"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "445e3fe0-edd4-4008-8776-57550d2f6768",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>monthly_inflation</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1996-01-01</td>\n",
       "      <td>83.87</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1996-02-01</td>\n",
       "      <td>84.23</td>\n",
       "      <td>0.429236</td>\n",
       "      <td>0.052742</td>\n",
       "      <td>5.274186</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1996-03-01</td>\n",
       "      <td>84.59</td>\n",
       "      <td>0.427401</td>\n",
       "      <td>0.052511</td>\n",
       "      <td>5.251112</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1996-04-01</td>\n",
       "      <td>84.81</td>\n",
       "      <td>0.260078</td>\n",
       "      <td>0.031660</td>\n",
       "      <td>3.165968</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1996-05-01</td>\n",
       "      <td>85.04</td>\n",
       "      <td>0.271194</td>\n",
       "      <td>0.033033</td>\n",
       "      <td>3.303315</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  TIME_PERIOD   HICP  monthly_inflation  annualized_inflation  \\\n",
       "0  1996-01-01  83.87                NaN                   NaN   \n",
       "1  1996-02-01  84.23           0.429236              0.052742   \n",
       "2  1996-03-01  84.59           0.427401              0.052511   \n",
       "3  1996-04-01  84.81           0.260078              0.031660   \n",
       "4  1996-05-01  85.04           0.271194              0.033033   \n",
       "\n",
       "   annualized_inflation_percent  \n",
       "0                           NaN  \n",
       "1                      5.274186  \n",
       "2                      5.251112  \n",
       "3                      3.165968  \n",
       "4                      3.303315  "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_hicp= pd.read_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/annualized_inflation-2.xlsx\")\n",
    "df_hicp.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "f8ca8913-413b-4f69-8afe-b5ea65858315",
   "metadata": {
    "collapsed": true,
    "jupyter": {
     "outputs_hidden": true
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Closest_DATE</th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>monthly_inflation</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>158.60</td>\n",
       "      <td>0.360691</td>\n",
       "      <td>0.044152</td>\n",
       "      <td>4.415198</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>158.03</td>\n",
       "      <td>-0.082195</td>\n",
       "      <td>-0.009819</td>\n",
       "      <td>-0.981896</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>158.16</td>\n",
       "      <td>0.113938</td>\n",
       "      <td>0.013759</td>\n",
       "      <td>1.375862</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>157.78</td>\n",
       "      <td>0.177778</td>\n",
       "      <td>0.021543</td>\n",
       "      <td>2.154317</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>157.21</td>\n",
       "      <td>0.588649</td>\n",
       "      <td>0.072970</td>\n",
       "      <td>7.297034</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
       "2  {(decis, taken), (measur, either), (growth, re...   \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
       "\n",
       "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  \\\n",
       "0                       NaN   2024-10-01  2024-10-01  158.60   \n",
       "1                  0.350419   2024-09-01  2024-09-01  158.03   \n",
       "2                  0.304114   2024-08-01  2024-08-01  158.16   \n",
       "3                  0.386910   2024-06-01  2024-06-01  157.78   \n",
       "4                  0.305423   2024-04-01  2024-04-01  157.21   \n",
       "\n",
       "   monthly_inflation  annualized_inflation  annualized_inflation_percent  \n",
       "0           0.360691              0.044152                      4.415198  \n",
       "1          -0.082195             -0.009819                     -0.981896  \n",
       "2           0.113938              0.013759                      1.375862  \n",
       "3           0.177778              0.021543                      2.154317  \n",
       "4           0.588649              0.072970                      7.297034  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Ensure both date columns are in datetime format\n",
    "df_all['Publication Date'] = pd.to_datetime(df_all['Publication Date'])\n",
    "df_hicp['TIME_PERIOD'] = pd.to_datetime(df_hicp['TIME_PERIOD'])\n",
    "\n",
    "# Find the closest date in df_y for each date in df_all\n",
    "def find_closest_date(publication_date, df_hicp_dates):\n",
    "    return df_hicp_dates.iloc[(df_hicp_dates - publication_date).abs().argsort()[0]]\n",
    "\n",
    "# Apply the function to match closest dates\n",
    "df_all['Closest_DATE'] = df_all['Publication Date'].apply(lambda x: find_closest_date(x, df_hicp['TIME_PERIOD']))\n",
    "\n",
    "# Merge the two DataFrames on the closest date\n",
    "merged_df = pd.merge(df_all, df_hicp, left_on='Closest_DATE', right_on='TIME_PERIOD', how='left')\n",
    "\n",
    "# Inspect the merged DataFrame\n",
    "merged_df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "91ce7096-ee6a-4094-8448-9c258d61db7c",
   "metadata": {},
   "source": [
    "# Merge with Output gap"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "df811657-e288-4e0e-89e7-bc8121fe6dee",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_y= pd.read_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Y_gap_quarterly.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "0e3ef3e9-a808-49d4-9545-fe5db240eb46",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>DATE</th>\n",
       "      <th>Y</th>\n",
       "      <th>Potential_GDP</th>\n",
       "      <th>Output_Gap</th>\n",
       "      <th>Output_Gap_Percent</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1999-01-01</td>\n",
       "      <td>2024045.8</td>\n",
       "      <td>2.051464e+06</td>\n",
       "      <td>-27418.172181</td>\n",
       "      <td>-1.336517</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1999-04-01</td>\n",
       "      <td>2033968.2</td>\n",
       "      <td>2.063238e+06</td>\n",
       "      <td>-29269.663186</td>\n",
       "      <td>-1.418628</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1999-07-01</td>\n",
       "      <td>2060663.8</td>\n",
       "      <td>2.074995e+06</td>\n",
       "      <td>-14330.817832</td>\n",
       "      <td>-0.690644</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1999-10-01</td>\n",
       "      <td>2081882.4</td>\n",
       "      <td>2.086699e+06</td>\n",
       "      <td>-4816.406224</td>\n",
       "      <td>-0.230815</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>2109624.5</td>\n",
       "      <td>2.098306e+06</td>\n",
       "      <td>11318.458297</td>\n",
       "      <td>0.539409</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        DATE          Y  Potential_GDP    Output_Gap  Output_Gap_Percent\n",
       "0 1999-01-01  2024045.8   2.051464e+06 -27418.172181           -1.336517\n",
       "1 1999-04-01  2033968.2   2.063238e+06 -29269.663186           -1.418628\n",
       "2 1999-07-01  2060663.8   2.074995e+06 -14330.817832           -0.690644\n",
       "3 1999-10-01  2081882.4   2.086699e+06  -4816.406224           -0.230815\n",
       "4 2000-01-01  2109624.5   2.098306e+06  11318.458297            0.539409"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_y.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "aba14a68-4fed-498c-bd37-055c76f045eb",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "                                                Link Publication Date  \\\n",
      "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
      "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
      "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
      "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
      "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
      "\n",
      "                                             Content  Days passed  \\\n",
      "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
      "1  frankfurt am main 12 september 2024 good after...         9386   \n",
      "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
      "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
      "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
      "\n",
      "                                   Processed Content  \\\n",
      "0  ljubljana octob good afternoon vicepresid welc...   \n",
      "1  frankfurt main septemb good afternoon vicepres...   \n",
      "2  frankfurt main juli good afternoon vicepresid ...   \n",
      "3  frankfurt main june good afternoon vicepresid ...   \n",
      "4  frankfurt main april good afternoon vicepresid...   \n",
      "\n",
      "                                             Bigrams  \\\n",
      "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
      "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
      "2  {(decis, taken), (measur, either), (growth, re...   \n",
      "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
      "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
      "\n",
      "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  \\\n",
      "0                       NaN   2024-07-01  2024-10-01  158.60   \n",
      "1                  0.350419   2024-07-01  2024-09-01  158.03   \n",
      "2                  0.304114   2024-07-01  2024-08-01  158.16   \n",
      "3                  0.386910   2024-07-01  2024-06-01  157.78   \n",
      "4                  0.305423   2024-04-01  2024-04-01  157.21   \n",
      "\n",
      "   monthly_inflation  annualized_inflation  annualized_inflation_percent  \\\n",
      "0           0.360691              0.044152                      4.415198   \n",
      "1          -0.082195             -0.009819                     -0.981896   \n",
      "2           0.113938              0.013759                      1.375862   \n",
      "3           0.177778              0.021543                      2.154317   \n",
      "4           0.588649              0.072970                      7.297034   \n",
      "\n",
      "        DATE          Y  Potential_GDP    Output_Gap  Output_Gap_Percent  \n",
      "0 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
      "1 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
      "2 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
      "3 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
      "4 2024-04-01  2821279.3   2.832474e+06 -11194.901096           -0.395234  \n"
     ]
    }
   ],
   "source": [
    "# Ensure both date columns are in datetime format\n",
    "merged_df['Publication Date'] = pd.to_datetime(merged_df['Publication Date'])\n",
    "df_y['DATE'] = pd.to_datetime(df_y['DATE'])\n",
    "\n",
    "# Find the closest date in df_y for each date in df_all\n",
    "def find_closest_date(publication_date, df_y_dates):\n",
    "    return df_y_dates.iloc[(df_y_dates - publication_date).abs().argsort()[0]]\n",
    "\n",
    "# Apply the function to match closest dates\n",
    "merged_df['Closest_DATE'] = merged_df['Publication Date'].apply(lambda x: find_closest_date(x, df_y['DATE']))\n",
    "\n",
    "# Merge the two DataFrames on the closest date\n",
    "merged_df = pd.merge(merged_df, df_y, left_on='Closest_DATE', right_on='DATE', how='left')\n",
    "\n",
    "# Inspect the merged DataFrame\n",
    "print(merged_df.head())"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "aa13513b-0f5f-479b-a585-f9746136d56e",
   "metadata": {},
   "source": [
    "# Merge with MRO"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "56f958f2-0d6f-4c1a-b3e5-891f5d373d06",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Closest_DATE</th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>monthly_inflation</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "      <th>DATE</th>\n",
       "      <th>Y</th>\n",
       "      <th>Potential_GDP</th>\n",
       "      <th>Output_Gap</th>\n",
       "      <th>Output_Gap_Percent</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>158.60</td>\n",
       "      <td>0.360691</td>\n",
       "      <td>0.044152</td>\n",
       "      <td>4.415198</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>158.03</td>\n",
       "      <td>-0.082195</td>\n",
       "      <td>-0.009819</td>\n",
       "      <td>-0.981896</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>158.16</td>\n",
       "      <td>0.113938</td>\n",
       "      <td>0.013759</td>\n",
       "      <td>1.375862</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>157.78</td>\n",
       "      <td>0.177778</td>\n",
       "      <td>0.021543</td>\n",
       "      <td>2.154317</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>157.21</td>\n",
       "      <td>0.588649</td>\n",
       "      <td>0.072970</td>\n",
       "      <td>7.297034</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2821279.3</td>\n",
       "      <td>2.832474e+06</td>\n",
       "      <td>-11194.901096</td>\n",
       "      <td>-0.395234</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
       "2  {(decis, taken), (measur, either), (growth, re...   \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
       "\n",
       "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  \\\n",
       "0                       NaN   2024-07-01  2024-10-01  158.60   \n",
       "1                  0.350419   2024-07-01  2024-09-01  158.03   \n",
       "2                  0.304114   2024-07-01  2024-08-01  158.16   \n",
       "3                  0.386910   2024-07-01  2024-06-01  157.78   \n",
       "4                  0.305423   2024-04-01  2024-04-01  157.21   \n",
       "\n",
       "   monthly_inflation  annualized_inflation  annualized_inflation_percent  \\\n",
       "0           0.360691              0.044152                      4.415198   \n",
       "1          -0.082195             -0.009819                     -0.981896   \n",
       "2           0.113938              0.013759                      1.375862   \n",
       "3           0.177778              0.021543                      2.154317   \n",
       "4           0.588649              0.072970                      7.297034   \n",
       "\n",
       "        DATE          Y  Potential_GDP    Output_Gap  Output_Gap_Percent  \n",
       "0 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
       "1 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
       "2 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
       "3 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977  \n",
       "4 2024-04-01  2821279.3   2.832474e+06 -11194.901096           -0.395234  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "merged_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "88803bda-6c73-443d-a0c3-6f998a6445f1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>DATE</th>\n",
       "      <th>Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1999-01-01</td>\n",
       "      <td>3.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1999-01-02</td>\n",
       "      <td>3.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1999-01-03</td>\n",
       "      <td>3.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1999-01-04</td>\n",
       "      <td>3.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1999-01-05</td>\n",
       "      <td>3.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        DATE  \\\n",
       "0 1999-01-01   \n",
       "1 1999-01-02   \n",
       "2 1999-01-03   \n",
       "3 1999-01-04   \n",
       "4 1999-01-05   \n",
       "\n",
       "   Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)  \n",
       "0                                                3.0                                                                   \n",
       "1                                                3.0                                                                   \n",
       "2                                                3.0                                                                   \n",
       "3                                                3.0                                                                   \n",
       "4                                                3.0                                                                   "
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_mro_sheet= pd.read_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/MRO.xlsm\")\n",
    "df_mro_sheet.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "d3ca83db-7c88-458f-b5d7-dfa50cefc10d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Clean and prepare df_mro_sheet\n",
    "df_mro_sheet['DATE'] = pd.to_datetime(df_mro_sheet['DATE'])  # Ensure DATE is a datetime\n",
    "merged_df['Publication Date'] = pd.to_datetime(merged_df['Publication Date'])\n",
    "\n",
    "# Merge the DataFrames on their respective date columns\n",
    "final_merged_with_mro = pd.merge(\n",
    "    merged_df,\n",
    "    df_mro_sheet,\n",
    "    left_on='Publication Date',\n",
    "    right_on='DATE',\n",
    "    how='left'\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "523760dc-e414-4269-b175-3c6390f05455",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Closest_DATE</th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>monthly_inflation</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "      <th>DATE_x</th>\n",
       "      <th>Y</th>\n",
       "      <th>Potential_GDP</th>\n",
       "      <th>Output_Gap</th>\n",
       "      <th>Output_Gap_Percent</th>\n",
       "      <th>Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>158.60</td>\n",
       "      <td>0.360691</td>\n",
       "      <td>0.044152</td>\n",
       "      <td>4.415198</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>3.65</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>158.03</td>\n",
       "      <td>-0.082195</td>\n",
       "      <td>-0.009819</td>\n",
       "      <td>-0.981896</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>158.16</td>\n",
       "      <td>0.113938</td>\n",
       "      <td>0.013759</td>\n",
       "      <td>1.375862</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>157.78</td>\n",
       "      <td>0.177778</td>\n",
       "      <td>0.021543</td>\n",
       "      <td>2.154317</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.338013</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>157.21</td>\n",
       "      <td>0.588649</td>\n",
       "      <td>0.072970</td>\n",
       "      <td>7.297034</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2821279.3</td>\n",
       "      <td>2.832474e+06</td>\n",
       "      <td>-11194.901096</td>\n",
       "      <td>-0.395234</td>\n",
       "      <td>4.50</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
       "2  {(decis, taken), (measur, either), (growth, re...   \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
       "\n",
       "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  \\\n",
       "0                  0.350419   2024-07-01  2024-10-01  158.60   \n",
       "1                  0.304114   2024-07-01  2024-09-01  158.03   \n",
       "2                  0.386910   2024-07-01  2024-08-01  158.16   \n",
       "3                  0.305423   2024-07-01  2024-06-01  157.78   \n",
       "4                  0.338013   2024-04-01  2024-04-01  157.21   \n",
       "\n",
       "   monthly_inflation  annualized_inflation  annualized_inflation_percent  \\\n",
       "0           0.360691              0.044152                      4.415198   \n",
       "1          -0.082195             -0.009819                     -0.981896   \n",
       "2           0.113938              0.013759                      1.375862   \n",
       "3           0.177778              0.021543                      2.154317   \n",
       "4           0.588649              0.072970                      7.297034   \n",
       "\n",
       "      DATE_x          Y  Potential_GDP    Output_Gap  Output_Gap_Percent  \\\n",
       "0 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977   \n",
       "1 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977   \n",
       "2 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977   \n",
       "3 2024-07-01  2831962.3   2.843249e+06 -11287.048503           -0.396977   \n",
       "4 2024-04-01  2821279.3   2.832474e+06 -11194.901096           -0.395234   \n",
       "\n",
       "   Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)  \n",
       "0                                               3.65                                                                   \n",
       "1                                               4.25                                                                   \n",
       "2                                               4.25                                                                   \n",
       "3                                               4.50                                                                   \n",
       "4                                               4.50                                                                   "
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Drop redundant DATE column if not needed\n",
    "final_merged_with_mro.drop(columns=['DATE_y'], inplace=True)\n",
    "\n",
    "# Shift the 'Similarity with Previous' column one step up\n",
    "final_merged_with_mro['Similarity with Previous'] = final_merged_with_mro['Similarity with Previous'].shift(-1)\n",
    "\n",
    "final_merged_with_mro.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c7db4f18-a06c-4342-8c89-b83631ee5615",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Create the new variable for the percentage change in MRO\n",
    "final_merged_with_mro['MRO_pct_change'] = (\n",
    "    (final_merged_with_mro['Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)'] \n",
    "    - final_merged_with_mro['Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)'].shift(1))\n",
    "    / final_merged_with_mro['Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)'].shift(1)\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1504cf3f-c353-4a2f-b505-6e4a014f8d3b",
   "metadata": {},
   "source": [
    "# Merge with Pessimism"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "12a025a1-d193-468a-a817-9ab43531995b",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_pe= pd.read_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Regression_2.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "f0927738-1eef-4224-8b0a-c50496ed7dc4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Pessimism</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{('continu', 'follow'), ('grow', 'strongli'), ...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.011855</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{('continu', 'follow'), ('grow', 'strongli'), ...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>0.017618</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{('continu', 'follow'), ('grow', 'strongli'), ...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>0.004989</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{('continu', 'follow'), ('grow', 'strongli'), ...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>0.005063</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{('continu', 'follow'), ('product', 'growth'),...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>0.013274</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {('continu', 'follow'), ('grow', 'strongli'), ...   \n",
       "1  {('continu', 'follow'), ('grow', 'strongli'), ...   \n",
       "2  {('continu', 'follow'), ('grow', 'strongli'), ...   \n",
       "3  {('continu', 'follow'), ('grow', 'strongli'), ...   \n",
       "4  {('continu', 'follow'), ('product', 'growth'),...   \n",
       "\n",
       "   Similarity with Previous  Pessimism  \n",
       "0                       NaN   0.011855  \n",
       "1                  0.350419   0.017618  \n",
       "2                  0.304114   0.004989  \n",
       "3                  0.386910   0.005063  \n",
       "4                  0.305423   0.013274  "
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_pe.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "1c72631e-3cdf-45ee-8694-966617247fcf",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "  Publication Date  Pessimism\n",
      "0       2024-10-17   0.011855\n",
      "1       2024-09-12   0.017618\n",
      "2       2024-07-18   0.004989\n",
      "3       2024-06-06   0.005063\n",
      "4       2024-04-11   0.013274\n"
     ]
    }
   ],
   "source": [
    "# Keep only 'Publication Date' and 'Pessimism' columns\n",
    "df_pe = df_pe[['Publication Date', 'Pessimism']]\n",
    "\n",
    "# Inspect the updated DataFrame\n",
    "print(df_pe.head())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "180c1dd1-be51-4304-9831-8bbdaaac39f1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Clean and prepare df_mro_sheet\n",
    "final_merged_with_mro['Publication Date'] = pd.to_datetime(final_merged_with_mro['Publication Date'])\n",
    "df_pe['Publication Date'] = pd.to_datetime(df_pe['Publication Date'])\n",
    "\n",
    "# Merge the DataFrames on their respective date columns\n",
    "final_merged_with_mro = pd.merge(\n",
    "    final_merged_with_mro,\n",
    "    df_pe,\n",
    "    left_on='Publication Date',\n",
    "    right_on='Publication Date',\n",
    "    how='left'\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "3111e83c-2a6c-4682-95c9-48e0294a162d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Closest_DATE</th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>...</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "      <th>DATE_x</th>\n",
       "      <th>Y</th>\n",
       "      <th>Potential_GDP</th>\n",
       "      <th>Output_Gap</th>\n",
       "      <th>Output_Gap_Percent</th>\n",
       "      <th>Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)</th>\n",
       "      <th>MRO_pct_change</th>\n",
       "      <th>Pessimism</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>158.60</td>\n",
       "      <td>...</td>\n",
       "      <td>0.044152</td>\n",
       "      <td>4.415198</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>3.65</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.011855</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>158.03</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.009819</td>\n",
       "      <td>-0.981896</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "      <td>0.164384</td>\n",
       "      <td>0.017618</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>158.16</td>\n",
       "      <td>...</td>\n",
       "      <td>0.013759</td>\n",
       "      <td>1.375862</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.004989</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>157.78</td>\n",
       "      <td>...</td>\n",
       "      <td>0.021543</td>\n",
       "      <td>2.154317</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.50</td>\n",
       "      <td>0.058824</td>\n",
       "      <td>0.005063</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.338013</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>157.21</td>\n",
       "      <td>...</td>\n",
       "      <td>0.072970</td>\n",
       "      <td>7.297034</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2821279.3</td>\n",
       "      <td>2.832474e+06</td>\n",
       "      <td>-11194.901096</td>\n",
       "      <td>-0.395234</td>\n",
       "      <td>4.50</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.013274</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 21 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
       "2  {(decis, taken), (measur, either), (growth, re...   \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
       "\n",
       "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  ...  \\\n",
       "0                  0.350419   2024-07-01  2024-10-01  158.60  ...   \n",
       "1                  0.304114   2024-07-01  2024-09-01  158.03  ...   \n",
       "2                  0.386910   2024-07-01  2024-08-01  158.16  ...   \n",
       "3                  0.305423   2024-07-01  2024-06-01  157.78  ...   \n",
       "4                  0.338013   2024-04-01  2024-04-01  157.21  ...   \n",
       "\n",
       "   annualized_inflation  annualized_inflation_percent     DATE_x          Y  \\\n",
       "0              0.044152                      4.415198 2024-07-01  2831962.3   \n",
       "1             -0.009819                     -0.981896 2024-07-01  2831962.3   \n",
       "2              0.013759                      1.375862 2024-07-01  2831962.3   \n",
       "3              0.021543                      2.154317 2024-07-01  2831962.3   \n",
       "4              0.072970                      7.297034 2024-04-01  2821279.3   \n",
       "\n",
       "   Potential_GDP    Output_Gap  Output_Gap_Percent  \\\n",
       "0   2.843249e+06 -11287.048503           -0.396977   \n",
       "1   2.843249e+06 -11287.048503           -0.396977   \n",
       "2   2.843249e+06 -11287.048503           -0.396977   \n",
       "3   2.843249e+06 -11287.048503           -0.396977   \n",
       "4   2.832474e+06 -11194.901096           -0.395234   \n",
       "\n",
       "   Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)  \\\n",
       "0                                               3.65                                                                    \n",
       "1                                               4.25                                                                    \n",
       "2                                               4.25                                                                    \n",
       "3                                               4.50                                                                    \n",
       "4                                               4.50                                                                    \n",
       "\n",
       "   MRO_pct_change  Pessimism  \n",
       "0             NaN   0.011855  \n",
       "1        0.164384   0.017618  \n",
       "2        0.000000   0.004989  \n",
       "3        0.058824   0.005063  \n",
       "4        0.000000   0.013274  \n",
       "\n",
       "[5 rows x 21 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "final_merged_with_mro.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "cb62d50b-97cb-4cfe-ac61-cb2c01e941ab",
   "metadata": {},
   "outputs": [],
   "source": [
    "final_merged_with_mro.to_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Regression_1_new.csv\", index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "b762882c-cb76-435f-89b2-960a1172bfbe",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Link</th>\n",
       "      <th>Publication Date</th>\n",
       "      <th>Content</th>\n",
       "      <th>Days passed</th>\n",
       "      <th>Processed Content</th>\n",
       "      <th>Bigrams</th>\n",
       "      <th>Similarity with Previous</th>\n",
       "      <th>Closest_DATE</th>\n",
       "      <th>TIME_PERIOD</th>\n",
       "      <th>HICP</th>\n",
       "      <th>...</th>\n",
       "      <th>annualized_inflation</th>\n",
       "      <th>annualized_inflation_percent</th>\n",
       "      <th>DATE_x</th>\n",
       "      <th>Y</th>\n",
       "      <th>Potential_GDP</th>\n",
       "      <th>Output_Gap</th>\n",
       "      <th>Output_Gap_Percent</th>\n",
       "      <th>Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)</th>\n",
       "      <th>MRO_pct_change</th>\n",
       "      <th>Pessimism</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-10-17</td>\n",
       "      <td>ljubljana 17 october 2024 good afternoon the v...</td>\n",
       "      <td>9421</td>\n",
       "      <td>ljubljana octob good afternoon vicepresid welc...</td>\n",
       "      <td>{(rate, better), (decis, taken), (ambiti, stru...</td>\n",
       "      <td>0.350419</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-10-01</td>\n",
       "      <td>158.60</td>\n",
       "      <td>...</td>\n",
       "      <td>0.044152</td>\n",
       "      <td>4.415198</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>3.65</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.011855</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-09-12</td>\n",
       "      <td>frankfurt am main 12 september 2024 good after...</td>\n",
       "      <td>9386</td>\n",
       "      <td>frankfurt main septemb good afternoon vicepres...</td>\n",
       "      <td>{(decis, taken), (slightli, june), (led, tempo...</td>\n",
       "      <td>0.304114</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-09-01</td>\n",
       "      <td>158.03</td>\n",
       "      <td>...</td>\n",
       "      <td>-0.009819</td>\n",
       "      <td>-0.981896</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "      <td>0.164384</td>\n",
       "      <td>0.017618</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-07-18</td>\n",
       "      <td>frankfurt am main 18 july 2024 good afternoon ...</td>\n",
       "      <td>9330</td>\n",
       "      <td>frankfurt main juli good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (measur, either), (growth, re...</td>\n",
       "      <td>0.386910</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-08-01</td>\n",
       "      <td>158.16</td>\n",
       "      <td>...</td>\n",
       "      <td>0.013759</td>\n",
       "      <td>1.375862</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.25</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.004989</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-06-06</td>\n",
       "      <td>frankfurt am main 6 june 2024 good afternoon t...</td>\n",
       "      <td>9288</td>\n",
       "      <td>frankfurt main june good afternoon vicepresid ...</td>\n",
       "      <td>{(decis, taken), (bank, remain), (growth, redu...</td>\n",
       "      <td>0.305423</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2024-06-01</td>\n",
       "      <td>157.78</td>\n",
       "      <td>...</td>\n",
       "      <td>0.021543</td>\n",
       "      <td>2.154317</td>\n",
       "      <td>2024-07-01</td>\n",
       "      <td>2831962.3</td>\n",
       "      <td>2.843249e+06</td>\n",
       "      <td>-11287.048503</td>\n",
       "      <td>-0.396977</td>\n",
       "      <td>4.50</td>\n",
       "      <td>0.058824</td>\n",
       "      <td>0.005063</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>https://www.ecb.europa.eu/press/press_conferen...</td>\n",
       "      <td>2024-04-11</td>\n",
       "      <td>frankfurt am main 11 april 2024 good afternoon...</td>\n",
       "      <td>9232</td>\n",
       "      <td>frankfurt main april good afternoon vicepresid...</td>\n",
       "      <td>{(decis, taken), (achiev, govern), (growth, in...</td>\n",
       "      <td>0.338013</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>157.21</td>\n",
       "      <td>...</td>\n",
       "      <td>0.072970</td>\n",
       "      <td>7.297034</td>\n",
       "      <td>2024-04-01</td>\n",
       "      <td>2821279.3</td>\n",
       "      <td>2.832474e+06</td>\n",
       "      <td>-11194.901096</td>\n",
       "      <td>-0.395234</td>\n",
       "      <td>4.50</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.013274</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 21 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                                Link Publication Date  \\\n",
       "0  https://www.ecb.europa.eu/press/press_conferen...       2024-10-17   \n",
       "1  https://www.ecb.europa.eu/press/press_conferen...       2024-09-12   \n",
       "2  https://www.ecb.europa.eu/press/press_conferen...       2024-07-18   \n",
       "3  https://www.ecb.europa.eu/press/press_conferen...       2024-06-06   \n",
       "4  https://www.ecb.europa.eu/press/press_conferen...       2024-04-11   \n",
       "\n",
       "                                             Content  Days passed  \\\n",
       "0  ljubljana 17 october 2024 good afternoon the v...         9421   \n",
       "1  frankfurt am main 12 september 2024 good after...         9386   \n",
       "2  frankfurt am main 18 july 2024 good afternoon ...         9330   \n",
       "3  frankfurt am main 6 june 2024 good afternoon t...         9288   \n",
       "4  frankfurt am main 11 april 2024 good afternoon...         9232   \n",
       "\n",
       "                                   Processed Content  \\\n",
       "0  ljubljana octob good afternoon vicepresid welc...   \n",
       "1  frankfurt main septemb good afternoon vicepres...   \n",
       "2  frankfurt main juli good afternoon vicepresid ...   \n",
       "3  frankfurt main june good afternoon vicepresid ...   \n",
       "4  frankfurt main april good afternoon vicepresid...   \n",
       "\n",
       "                                             Bigrams  \\\n",
       "0  {(rate, better), (decis, taken), (ambiti, stru...   \n",
       "1  {(decis, taken), (slightli, june), (led, tempo...   \n",
       "2  {(decis, taken), (measur, either), (growth, re...   \n",
       "3  {(decis, taken), (bank, remain), (growth, redu...   \n",
       "4  {(decis, taken), (achiev, govern), (growth, in...   \n",
       "\n",
       "   Similarity with Previous Closest_DATE TIME_PERIOD    HICP  ...  \\\n",
       "0                  0.350419   2024-07-01  2024-10-01  158.60  ...   \n",
       "1                  0.304114   2024-07-01  2024-09-01  158.03  ...   \n",
       "2                  0.386910   2024-07-01  2024-08-01  158.16  ...   \n",
       "3                  0.305423   2024-07-01  2024-06-01  157.78  ...   \n",
       "4                  0.338013   2024-04-01  2024-04-01  157.21  ...   \n",
       "\n",
       "   annualized_inflation  annualized_inflation_percent     DATE_x          Y  \\\n",
       "0              0.044152                      4.415198 2024-07-01  2831962.3   \n",
       "1             -0.009819                     -0.981896 2024-07-01  2831962.3   \n",
       "2              0.013759                      1.375862 2024-07-01  2831962.3   \n",
       "3              0.021543                      2.154317 2024-07-01  2831962.3   \n",
       "4              0.072970                      7.297034 2024-04-01  2821279.3   \n",
       "\n",
       "   Potential_GDP    Output_Gap  Output_Gap_Percent  \\\n",
       "0   2.843249e+06 -11287.048503           -0.396977   \n",
       "1   2.843249e+06 -11287.048503           -0.396977   \n",
       "2   2.843249e+06 -11287.048503           -0.396977   \n",
       "3   2.843249e+06 -11287.048503           -0.396977   \n",
       "4   2.832474e+06 -11194.901096           -0.395234   \n",
       "\n",
       "   Main refinancing operations - Minimum bid rate/fixed rate (date of changes) - Level (FM.D.U2.EUR.4F.KR.MRR_RT.LEV)  \\\n",
       "0                                               3.65                                                                    \n",
       "1                                               4.25                                                                    \n",
       "2                                               4.25                                                                    \n",
       "3                                               4.50                                                                    \n",
       "4                                               4.50                                                                    \n",
       "\n",
       "   MRO_pct_change  Pessimism  \n",
       "0             NaN   0.011855  \n",
       "1        0.164384   0.017618  \n",
       "2        0.000000   0.004989  \n",
       "3        0.058824   0.005063  \n",
       "4        0.000000   0.013274  \n",
       "\n",
       "[5 rows x 21 columns]"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "final_merged_with_mro.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "0b691e1b-a9c9-4bb4-9bf2-70a1f8de4960",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_all= pd.read_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Regression_1_new.csv\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "26c93040-65f3-4f8b-ad50-a9993c658ab5",
   "metadata": {},
   "source": [
    "# Merge with Stock Markets"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "dd390462-1985-40bb-9a15-7af8bc7a5ddc",
   "metadata": {},
   "outputs": [],
   "source": [
    "df=pd.read_excel(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/StockMarket.xlsx\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "627396ee-912a-4f02-ba00-105e785ecdb5",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Step 1: Ensure 'Publication Date' and 'Date' are datetime\n",
    "df_all['Publication Date'] = pd.to_datetime(df_all['Publication Date'])\n",
    "df['Date'] = pd.to_datetime(df['Date'])\n",
    "\n",
    "# Step 2: Merge the two DataFrames\n",
    "merged_df = pd.merge(\n",
    "    df_all,           # First DataFrame\n",
    "    df,               # Second DataFrame\n",
    "    left_on='Publication Date',  # Column from df_all\n",
    "    right_on='Date',  # Column from df\n",
    "    how='inner'       # Merge type (e.g., 'inner', 'left', 'right', 'outer')\n",
    ")\n",
    "\n",
    "# Step 3: Drop the redundant 'Date' column if needed\n",
    "merged_df.drop(columns=['Date'], inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "id": "2c088c33-9c38-403d-adf5-0ba522c70ce9",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Initialize a new column in merged_df for CAR\n",
    "merged_df['CAR'] = np.nan  # Placeholder for the CAR values\n",
    "\n",
    "# Loop through each announcement date in `Publication Date`\n",
    "for date in merged_df['Publication Date']:\n",
    "    # Define the estimation window: [t-250, t-50]\n",
    "    estimation_start = date - pd.Timedelta(days=250)\n",
    "    estimation_end = date - pd.Timedelta(days=50)\n",
    "    estimation_window = merged_df[\n",
    "        (merged_df['Publication Date'] >= estimation_start) &\n",
    "        (merged_df['Publication Date'] <= estimation_end)\n",
    "    ]['Return']\n",
    "    \n",
    "    # Calculate the mean return over the estimation window\n",
    "    mean_return = estimation_window.mean()\n",
    "    \n",
    "    # Define the event window: [t-5, t+5]\n",
    "    event_start = date - pd.Timedelta(days=5)\n",
    "    event_end = date + pd.Timedelta(days=5)\n",
    "    event_window = merged_df[\n",
    "        (merged_df['Publication Date'] >= event_start) &\n",
    "        (merged_df['Publication Date'] <= event_end)\n",
    "    ].copy()\n",
    "    \n",
    "    # Calculate abnormal returns (AR)\n",
    "    event_window['Abnormal Return'] = event_window['Return'] - mean_return\n",
    "    \n",
    "    # Calculate cumulative abnormal returns (CAR)\n",
    "    CAR = event_window['Abnormal Return'].sum()\n",
    "    \n",
    "    # Assign CAR to the corresponding rows in merged_df\n",
    "    merged_df.loc[\n",
    "        (merged_df['Publication Date'] >= event_start) &\n",
    "        (merged_df['Publication Date'] <= event_end),\n",
    "        'CAR'\n",
    "    ] = abs(CAR)  # Store absolute value of CAR"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "da27553b-d15a-4e14-aedc-afaa18c58a1a",
   "metadata": {},
   "outputs": [],
   "source": [
    "merged_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "id": "a13fa591-d120-4c79-8be6-d97df1d4a386",
   "metadata": {},
   "outputs": [],
   "source": [
    "merged_df.to_csv(\"/Users/biancafernandes/Documents/FTD_Semestre_1/Applied_Data_Science/Final_Project/Regression_1_new.csv\", index=False)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a848531e-baa5-4ed9-898e-7553aa91b56b",
   "metadata": {},
   "source": [
    "## Regressions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0f03be18-1660-4eda-900b-1c9bd3968a12",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "efefd6c2-fd57-4370-a426-3f5df9728b45",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bdfeab26-13eb-4482-9c07-05f5c9fffe62",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "80802149-c62f-4654-8e89-99ba4f67b2ae",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "4416ab41-0d9f-4143-91b0-bf3443c1f77d",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8354eb36-5d55-48ed-9914-9e5204bed472",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2a50d0f1-c6c3-4382-970a-95376f7231d6",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "98c7c901-0aee-4cec-8169-d1dc2f69a59e",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "53705411-7354-4ba9-8d0c-272f18bd2bbc",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "39bbce2c-0102-48c2-942d-69d462a634d5",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9995aff0-6de3-4766-8acc-67c86e3d5218",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "526d8592-f735-4bd5-a442-b966f928670b",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
